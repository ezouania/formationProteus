<script>
  netlifyIdentity.on('init', async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // Recharge les données utilisateur depuis Netlify Identity
    const freshUser = await netlifyIdentity.refresh();

    // Si l'email n'est pas confirmé
    if (!freshUser || !freshUser.confirmed_at) {
      alert("Ton email n’est pas confirmé. Clique sur le lien reçu par email, puis reconnecte-toi.");
      netlifyIdentity.logout();
      return;
    }

    document.getElementById("welcome").innerText = "Bienvenue " + freshUser.user_metadata.full_name;
  });

  netlifyIdentity.on('logout', () => {
    window.location.href = "index.html";
  });

  netlifyIdentity.init();
</script>
